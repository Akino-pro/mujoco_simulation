<?xml version="1.0" encoding="utf-8"?>
<mujoco model="gen3_scene">
  <compiler angle="radian" autolimits="true"/>

  <option timestep="0.002" gravity="0 0 -9.81" integrator="RK4"
          impratio="20" density="1.2" viscosity="2e-05" cone="elliptic"/>
  <size njmax="5000" nconmax="5000"/>

  <visual>
    <global offwidth="480" offheight="480" fovy="60"/>
    <map znear="0.001"/>
  </visual>

  <asset>
    <!-- ================= Robosuite arena assets ================= -->
    <!-- Skybox -->
    <texture type="skybox" colorspace="auto" builtin="gradient"
             rgb1="0.9 0.9 1" rgb2="0.2 0.3 0.4" width="256" height="1536"/>

    <!-- Arena textures -->
    <texture type="2d" colorspace="sRGB" name="texplane"
             file="textures/light-gray-floor-tile.png"/>
    <texture type="2d" colorspace="sRGB" name="tex-wood"
             file="textures/light_wood.png"/>
    <texture type="cube" colorspace="linear" name="tex-steel-brushed"
             file="textures/steel-brushed.png"/>
    <texture type="2d" colorspace="linear" name="tex-light-gray-plaster"
             file="textures/light-gray-plaster.png"/>

    <!-- Materials -->
    <material name="floorplane" texture="texplane" texuniform="true" texrepeat="2 2"
              specular="0" shininess="0" reflectance="0.01"/>
    <material name="table_wood"
          texture="tex-wood"
          texuniform="true"
          texrepeat="1 1"
          specular="0.35"
          shininess="0.4"
          reflectance="0.15"/>
    <material name="table_legs_metal" texture="tex-steel-brushed" shininess="0.8" reflectance="0.8"/>
    <material name="walls_mat" texture="tex-light-gray-plaster" texuniform="true" texrepeat="3 3"
              specular="0.1" shininess="0.1"/>

    <!-- ================= Your cube materials ================= -->
    <material name="mat_green" rgba="0.10 0.90 0.10 1"/>
    <material name="mat_blue"  rgba="0.10 0.30 0.95 1"/>

    <!-- ================= Robot meshes/materials (INLINED) ================= -->
    <mesh name="base_link" content_type="model/stl" file="base_link.stl"/>
    <mesh name="shoulder_link" content_type="model/stl" file="shoulder_link.stl"/>
    <mesh name="half_arm_1_link" content_type="model/stl" file="half_arm_1_link.stl"/>
    <mesh name="half_arm_2_link" content_type="model/stl" file="half_arm_2_link.stl"/>
    <mesh name="forearm_link" content_type="model/stl" file="forearm_link.stl"/>
    <mesh name="spherical_wrist_1_link" content_type="model/stl" file="spherical_wrist_1_link.stl"/>
    <mesh name="spherical_wrist_2_link" content_type="model/stl" file="spherical_wrist_2_link.stl"/>
    <mesh name="bracelet_no_vision_link" content_type="model/stl" file="bracelet_no_vision_link.stl"/>
    <mesh name="robotiq_base" content_type="model/stl" file="robotiq_base.stl"/>
    <mesh name="left_knuckle" content_type="model/stl" file="left_knuckle.stl"/>
    <mesh name="right_knuckle" content_type="model/stl" file="right_knuckle.stl"/>
    <mesh name="left_finger" content_type="model/stl" file="left_finger.stl"/>
    <mesh name="right_finger" content_type="model/stl" file="right_finger.stl"/>
    <mesh name="left_inner_knuckle" content_type="model/stl" file="left_inner_knuckle.stl"/>
    <mesh name="right_inner_knuckle" content_type="model/stl" file="right_inner_knuckle.stl"/>
    <mesh name="left_finger_tip" content_type="model/stl" file="left_finger_tip.stl"/>
    <mesh name="right_finger_tip" content_type="model/stl" file="right_finger_tip.stl"/>
    <mesh name="bracelet_with_vision_link" content_type="model/stl" file="bracelet_with_vision_link.stl"/>
  </asset>

  <worldbody>
    <!-- ================= Robosuite arena world ================= -->
    <!-- Floor -->
    <geom name="floor" size="3 3 0.125" type="plane" group="1" material="floorplane"/>

    <!-- Walls (visual only) -->
    <geom name="wall_leftcorner_visual"  size="1.06 1.5 0.01" pos="-1.25  2.25 1.5"
          quat="0.653281 0.653281 0.270598 0.270598" type="box" contype="0" conaffinity="0"
          group="1" material="walls_mat"/>
    <geom name="wall_rightcorner_visual" size="1.06 1.5 0.01" pos="-1.25 -2.25 1.5"
          quat="0.653281 0.653281 -0.270598 -0.270598" type="box" contype="0" conaffinity="0"
          group="1" material="walls_mat"/>
    <geom name="wall_left_visual"  size="1.75 1.5 0.01" pos=" 1.25  3.0 1.5"
          quat="0.707107 0.707107 0 0" type="box" contype="0" conaffinity="0"
          group="1" material="walls_mat"/>
    <geom name="wall_right_visual" size="1.75 1.5 0.01" pos=" 1.25 -3.0 1.5"
          quat="0.707107 -0.707107 0 0" type="box" contype="0" conaffinity="0"
          group="1" material="walls_mat"/>
    <geom name="wall_rear_visual"  size="1.5 1.5 0.01" pos="-2.0  0.0 1.5"
          quat="0.5 0.5 0.5 0.5" type="box" contype="0" conaffinity="0"
          group="1" material="walls_mat"/>
    <geom name="wall_front_visual" size="3.0 1.5 0.01" pos=" 3.0  0.0 1.5"
          quat="0.5 0.5 -0.5 -0.5" type="box" contype="0" conaffinity="0"
          group="1" material="walls_mat"/>

    <!-- Cameras (optional) -->
    <camera name="frontview" pos="1.6 0 1.45" quat="0.560842 0.430646 0.430646 0.560842"/>
    <camera name="birdview"  pos="-0.2 0 3"  quat="0.707107 0 0 0.707107"/>
    <camera name="agentview" pos="0.5 0 1.35" quat="0.653098 0.271041 0.271041 0.653098"/>
    <camera name="sideview"  pos="-0.0565177 1.27612 1.48796" quat="0.00990507 0.00687796 0.591223 0.806418"/>
    <camera name="wrist_rgb" mode="fixed" pos="0 0 0" quat="1 0 0 0" fovy="60"/>

    <!-- NEW: Fixed overhead camera (lab measurement)
         table top = 0.72 m above ground, camera is +0.43 m above table top => z = 1.15
         x = +0.10 m, y = +0.50 m relative to Kinova base frame (assumed at world origin)
         Looking straight down (-Z): identity quat works
    -->
     <!-- Fixed overhead camera: 1.0668m above 0.72m table -->
    <camera name="fixed_down"
            mode="fixed"
            pos="0.10 0.50 1.7868"
            quat="1 0 0 0"
            fovy="60"/>

   <!-- ================= Fixed camera rig marker (Γ-shape) ================= -->
    <!-- Camera stays at (0.10, 0.50, 1.7868). Stand base is on right table at x=0.15. -->
    <body name="fixed_cam_rig" pos="0.20 0.50 0.72">

      <!-- Base plate sitting on table -->
      <geom name="fixed_cam_baseplate" type="cylinder"
            size="0.06 0.01"
            pos="0.05 0 0"
            rgba="0.15 0.15 0.15 1"
            contype="0" conaffinity="0" group="1"/>

      <!-- Vertical pole: from table top (z=0.72) up to camera height (z=1.7868) -->
      <!-- height = 1.0668 -->
      <geom name="fixed_cam_pole" type="capsule"
            fromto="0.05 0 0   0.05 0 1.0668"
            size="0.012"
            rgba="0.2 0.2 0.2 1"
            contype="0" conaffinity="0" group="1"/>

      <!-- Horizontal arm at the top: 5cm toward robot table (negative X) -->
      <!-- from (x=0.15) to camera x=0.10 => -0.05 in local X -->
      <geom name="fixed_cam_arm" type="capsule"
            fromto="0.05 0 1.0668   -0.05 0 1.0668"
            size="0.010"
            rgba="0.2 0.2 0.2 1"
            contype="0" conaffinity="0" group="1"/>

      <!-- Small camera box at the arm end, aligned with fixed_down camera position -->
      <geom name="fixed_cam_box" type="box"
            pos="-0.05 0 1.0668"
            size="0.04 0.025 0.02"
            rgba="0.05 0.05 0.05 1"
            contype="0" conaffinity="0" group="1"/>

      <!-- “Lens” pointing down -->
      <geom name="fixed_cam_lens" type="cylinder"
            pos="-0.05 0 1.0368"
            size="0.01 0.02"
            rgba="0.12 0.12 0.12 1"
            contype="0" conaffinity="0" group="1"/>

      <!-- Downward ray from camera location (visual only) -->
      <geom name="fixed_cam_ray" type="capsule"
            fromto="-0.05 0 1.0668   -0.05 0 0.00"
            size="0.003"
            rgba="1 0 0 1"
            contype="0" conaffinity="0" group="1"/>

      <site name="fixed_cam_site" pos="-0.05 0 1.0668" size="0.01" rgba="1 0 0 1"/>
    </body>

    <!-- Light -->
    <light pos="1 1 1.5" dir="-0.19245 -0.19245 -0.96225" type="directional" castshadow="false"/>

    <!-- Robosuite Table (SPLIT INTO TWO TABLES WITH 1cm GAP AT x=0.05) -->
    <!-- Table height: body z=0.695 => table top z=0.695+0.025=0.72 -->
        <!-- ================= Two tables aligned with 5cm gap ================= -->
    <!-- Table top target: z = 0.72  => body z = 0.72 - 0.025 = 0.695 -->
    <!-- Left table right edge is at x=0.0 (robot base at edge) -->
    <body name="arena_table_left" pos="-0.35 0.3 0.695">
      <!-- top (collision) -->
      <geom name="table_left_collision" size="0.4 0.8 0.025" type="box"
            rgba="0.5 0.5 0 1" contype="1" conaffinity="1"/>
      <!-- top (visual) -->
      <geom name="table_left_visual" size="0.4 0.8 0.025" type="box"
            contype="0" conaffinity="0" group="1" material="table_wood"/>

      <!-- legs (visual only) -->
      <geom name="table_left_leg1_visual" size="0.025 0.3875" pos=" 0.3  0.7 -0.3875" type="cylinder"
            contype="0" conaffinity="0" group="1" material="table_legs_metal"/>
      <geom name="table_left_leg2_visual" size="0.025 0.3875" pos="-0.3  0.7 -0.3875" type="cylinder"
            contype="0" conaffinity="0" group="1" material="table_legs_metal"/>
      <geom name="table_left_leg3_visual" size="0.025 0.3875" pos="-0.3 -0.7 -0.3875" type="cylinder"
            contype="0" conaffinity="0" group="1" material="table_legs_metal"/>
      <geom name="table_left_leg4_visual" size="0.025 0.3875" pos=" 0.3 -0.7 -0.3875" type="cylinder"
            contype="0" conaffinity="0" group="1" material="table_legs_metal"/>

      <site name="table_top_left" pos="0 0 0.025" size="0.006" rgba="1 0 0 0.8"/>
    </body>

    <!-- Right table left edge is at x=0.05 (5cm gap from left table) -->
    <body name="arena_table_right" pos="0.6 0.3 0.695">
      <!-- top (collision) -->
      <geom name="table_right_collision" size="0.4 0.8 0.025" type="box"
            rgba="0.5 0.5 0 1" contype="1" conaffinity="1"/>
      <!-- top (visual) -->
      <geom name="table_right_visual" size="0.4 0.8 0.025" type="box"
            contype="0" conaffinity="0" group="1" material="table_wood"/>

      <!-- legs (visual only) -->
      <geom name="table_right_leg1_visual" size="0.025 0.3875" pos=" 0.3  0.7 -0.3875" type="cylinder"
            contype="0" conaffinity="0" group="1" material="table_legs_metal"/>
      <geom name="table_right_leg2_visual" size="0.025 0.3875" pos="-0.3  0.7 -0.3875" type="cylinder"
            contype="0" conaffinity="0" group="1" material="table_legs_metal"/>
      <geom name="table_right_leg3_visual" size="0.025 0.3875" pos="-0.3 -0.7 -0.3875" type="cylinder"
            contype="0" conaffinity="0" group="1" material="table_legs_metal"/>
      <geom name="table_right_leg4_visual" size="0.025 0.3875" pos=" 0.3 -0.7 -0.3875" type="cylinder"
            contype="0" conaffinity="0" group="1" material="table_legs_metal"/>

      <site name="table_top_right" pos="0 0 0.025" size="0.006" rgba="0 0 1 0.8"/>
    </body>

    <!-- ================= Your cubes on table ================= -->
    <!-- NOTE: your comment says cube center should be 0.825, but your bodies use 0.85.
         Leaving your original numbers unchanged to avoid breaking your setup.
         If you want the cube bottoms exactly on the table, use z=0.825 instead.
    -->
    <body name="green_cube" pos="0.45  0.18 0.77">
      <geom type="box" size="0.025 0.025 0.025" material="mat_green" contype="1" conaffinity="1" density="300"/>
    </body>
    <body name="blue_cube" pos="0.45 -0.18 0.77">
      <geom type="box" size="0.025 0.025 0.025" material="mat_blue" contype="1" conaffinity="1" density="300"/>
    </body>

    <!-- ================= Your robot mounted on Robosuite table top ================= -->
    <body name="gen3_mount" pos="0 0 0.72">
      <geom type="mesh" mesh="base_link"/>
      <body name="gen3_shoulder_link" pos="0 0 0.15643" quat="-3.67321e-06 1 0 0">
        <inertial pos="-2.3e-05 -0.010364 -0.07336" quat="0.707051 0.0451246 -0.0453544 0.704263" mass="1.3773" diaginertia="0.00488868 0.00457 0.00135132"/>
        <joint name="gen3_joint_1" pos="0 0 0" axis="0 0 1" actuatorfrcrange="-39 39"/>
        <geom type="mesh" rgba="0.75294 0.75294 0.75294 1" mesh="shoulder_link"/>
        <body name="gen3_half_arm_1_link" pos="0 0.005375 -0.12838" quat="0.707105 0.707108 0 0">
          <inertial pos="-4.4e-05 -0.09958 -0.013278" quat="0.482348 0.516286 -0.516862 0.483366" mass="1.1636" diaginertia="0.0113017 0.011088 0.00102532"/>
          <joint name="gen3_joint_2" pos="0 0 0" axis="0 0 1" range="-2.41 2.41" actuatorfrcrange="-39 39"/>
          <geom type="mesh" rgba="0.75294 0.75294 0.75294 1" mesh="half_arm_1_link"/>
          <body name="gen3_half_arm_2_link" pos="0 -0.21038 -0.006375" quat="0.707105 -0.707108 0 0">
            <inertial pos="-4.4e-05 -0.006641 -0.117892" quat="0.706144 0.0213722 -0.0209128 0.707437" mass="1.1636" diaginertia="0.0111633 0.010932 0.00100671"/>
            <joint name="gen3_joint_3" pos="0 0 0" axis="0 0 1" actuatorfrcrange="-39 39"/>
            <geom type="mesh" rgba="0.75294 0.75294 0.75294 1" mesh="half_arm_2_link"/>
            <body name="gen3_forearm_link" pos="0 0.006375 -0.21038" quat="0.707105 0.707108 0 0">
              <inertial pos="-1.8e-05 -0.075478 -0.015006" quat="0.483678 0.515961 -0.515859 0.483455" mass="0.9302" diaginertia="0.00834839 0.008147 0.000598606"/>
              <joint name="gen3_joint_4" pos="0 0 0" axis="0 0 1" range="-2.66 2.66" actuatorfrcrange="-39 39"/>
              <geom type="mesh" rgba="0.75294 0.75294 0.75294 1" mesh="forearm_link"/>
              <body name="gen3_spherical_wrist_1_link" pos="0 -0.20843 -0.006375" quat="0.707105 -0.707108 0 0">
                <inertial pos="1e-06 -0.009432 -0.063883" quat="0.703558 0.0707492 -0.0707492 0.703558" mass="0.6781" diaginertia="0.00165901 0.001596 0.000346988"/>
                <joint name="gen3_joint_5" pos="0 0 0" axis="0 0 1" actuatorfrcrange="-9 9"/>
                <geom type="mesh" rgba="0.75294 0.75294 0.75294 1" mesh="spherical_wrist_1_link"/>
                <body name="gen3_spherical_wrist_2_link" pos="0 0.00017505 -0.10593" quat="0.707105 0.707108 0 0">
                  <inertial pos="1e-06 -0.045483 -0.00965" quat="0.44426 0.550121 -0.550121 0.44426" mass="0.6781" diaginertia="0.00170087 0.001641 0.00035013"/>
                  <joint name="gen3_joint_6" pos="0 0 0" axis="0 0 1" range="-2.23 2.23" actuatorfrcrange="-9 9"/>
                  <geom type="mesh" rgba="0.75294 0.75294 0.75294 1" mesh="spherical_wrist_2_link"/>
                  <body name="gen3_bracelet_link" pos="0 -0.10593 -0.00017505" quat="0.707105 -0.707108 0 0">
                    <inertial pos="0.000967136 0.00592216 -0.0302303" quat="0.707949 0.693027 -0.101455 0.0907149" mass="1.5992" diaginertia="0.00562397 0.00533749 0.00190074"/>
                    <joint name="gen3_joint_7" pos="0 0 0" axis="0 0 1" actuatorfrcrange="-9 9"/>
                    <geom type="mesh" rgba="0.75294 0.75294 0.75294 1" mesh="bracelet_no_vision_link"/>
                    <geom pos="0 0 -0.061525" quat="0 1 0 0" type="mesh" mesh="robotiq_base"/>
                    <geom size="0.010025 0.0495 0.0115" pos="-4.16066e-08 -0.0797371 -0.0524269" quat="0.454758 0.541475 0.541473 -0.45476" type="box"/>
                    <geom type="mesh" mesh="bracelet_with_vision_link"/>
                    <body name="gen3_robotiq_85_left_knuckle_link" pos="0.0306011 0 -0.11643" quat="0 1 0 0">
                      <inertial pos="0.0280921 -0.000550523 0.00570126" quat="0.699112 0.212074 0.213677 0.648544" mass="0.0564515" diaginertia="1.95637e-05 1.76663e-05 9.3792e-06"/>
                      <joint name="gen3_robotiq_85_left_knuckle_joint" pos="0 0 0" axis="0 -1 0" range="0 0.8" actuatorfrcrange="-50 50"/>
                      <geom type="mesh" mesh="left_knuckle"/>
                      <geom pos="0.0315262 0 -0.00376347" type="mesh" mesh="left_finger"/>
                      <body name="gen3_robotiq_85_left_finger_tip_link" pos="0.0371575 0 0.0434217">
                        <inertial pos="-0.0145671 -0.0008 0.016497" quat="0.977773 0 -0.209665 0" mass="0.0426859" diaginertia="1.20653e-05 1.19789e-05 2.64405e-06"/>
                        <joint name="gen3_robotiq_85_left_finger_tip_joint" pos="0 0 0" axis="0 -1 0"/>
                        <geom type="mesh" mesh="left_finger_tip"/>
                      </body>
                    </body>
                    <body name="gen3_robotiq_85_right_knuckle_link" pos="-0.0306011 0 -0.11643" quat="0 1 0 0">
                      <inertial pos="-0.0280921 4.48872e-05 0.00570126" quat="0.669099 -0.212862 -0.212522 0.679581" mass="0.0564515" diaginertia="1.95514e-05 1.7665e-05 9.37296e-06"/>
                      <joint name="gen3_robotiq_85_right_knuckle_joint" pos="0 0 0" axis="0 -1 0" range="-0.8 0" actuatorfrcrange="-50 50"/>
                      <geom type="mesh" mesh="right_knuckle"/>
                      <geom pos="-0.0315262 0 -0.00376347" type="mesh" mesh="right_finger"/>
                      <body name="gen3_robotiq_85_right_finger_tip_link" pos="-0.0371575 0 0.0434217">
                        <inertial pos="0.0145671 5e-05 0.016497" quat="0.977773 0 0.209665 0" mass="0.0426859" diaginertia="1.20653e-05 1.19789e-05 2.64405e-06"/>
                        <joint name="gen3_robotiq_85_right_finger_tip_joint" pos="0 0 0" axis="0 -1 0"/>
                        <geom type="mesh" mesh="right_finger_tip"/>
                      </body>
                    </body>
                    <body name="gen3_robotiq_85_left_inner_knuckle_link" pos="0.0127 0 -0.122945" quat="0 1 0 0">
                      <inertial pos="0.018977 0.00015001 0.022471" quat="0.939613 0 0.342237 0" mass="0.0296938" diaginertia="1.28757e-05 8.69056e-06 4.88712e-06"/>
                      <joint name="gen3_robotiq_85_left_inner_knuckle_joint" pos="0 0 0" axis="0 -1 0"/>
                      <geom type="mesh" mesh="left_inner_knuckle"/>
                    </body>
                    <body name="gen3_robotiq_85_right_inner_knuckle_link" pos="-0.0127 0 -0.122945" quat="0 1 0 0">
                      <inertial pos="-0.0192682 5.001e-05 0.0222218" quat="0.936371 0 -0.351012 0" mass="0.0296938" diaginertia="1.2882e-05 8.69056e-06 4.88076e-06"/>
                      <joint name="gen3_robotiq_85_right_inner_knuckle_joint" pos="0 0 0" axis="0 -1 0"/>
                      <geom type="mesh" mesh="right_inner_knuckle"/>
                    </body>
                  </body>
                </body>
              </body>
            </body>
          </body>
        </body>
      </body>
    </body>
  </worldbody>
</mujoco>